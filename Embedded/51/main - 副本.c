#include <REGX52.H>
#include "Timer0.h"
#include "Delay.h"

sbit Buzzer=P2^5;

#define SPEED	553

unsigned int FreqTable[]={0,
	64291,64360,64426,64489,64547,
	64603,64655,64704,64751,64795,64837,64876,64913,64948,64981,65012,65042,
	65070,65095,65120,65144,65166,65186,65206,65225,65242,65259,65274,65289,
	65303
};
unsigned char code Music[]={
	22,4, 20,2, 18,4, 20,2,		22,3, 23,1, 22,2, 20,6,		22,4, 20,2, 18,4, 20,2,		22,3, 23,1, 22,2, 20,6,
	22,4, 20,2, 18,4, 20,2,		22,3, 23,1, 22,2, 20,6,		22,4, 20,2, 18,4, 20,2,		22,3, 23,1, 22,2, 20,4, 6,1, 8,1,
	10,2, 10,2, 8,2, 11,2, 10,2, 8,2,		8,2, 8,2, 6,1, 6,1, 11,2, 10,2, 8,2,		8,4, 6,1, 8,1, 10,6,
	0,6, 10,2, 13,2, 18,2,	17,4, 18,4, 17,2, 18,2,		17,1, 15,1, 13,4, 13,2, 8,2, 11,2,		11,4, 10,2, 10,4, 1,2,		11,2, 10,2, 8,2, 10,4, 13,2,
	6,6, 0,4, 6,2,		8,2, 6,3, 6,1, 6,2, 13,2, 6,2,		11,4, 10,2, 8,4, 6,2,		6,6, 0,4, 6,1, 8,1,
	10,2, 10,2, 8,2,	11,2, 10,2, 8,2,		8,2, 8,2, 6,2, 11,2, 10,2, 8,2,		8,4, 6,1, 8,1, 10,6,
	0,6, 10,2, 13,2, 18,2,		17,4, 18,2, 17,4, 18,2,		17,1, 15,1, 13,4, 13,2, 8,2, 11,2,		11,4, 10,2, 10,4, 1,2,		11,2, 10,2, 8,2, 10,4, 13,2,
	6,6, 0,4, 6,1, 6,1,		8,2, 6,4, 6,2, 13,2, 6,2,		11,2, 11,1, 11,1, 10,1, 8,1, 8,4, 6,2,		6,3, 0,3, 0,6,
	27,2, 25,2, 25,2, 25,2, 23,2, 23,2,		22,2, 20,2, 20,2, 20,2, 0,2, 13,2,		13,2, 11,1, 11,1, 11,2, 11,2, 10,2, 8,2,		8,4, 6,1, 5,1, 6,3, 0,3,
	27,2, 25,2, 25,2, 25,2, 23,2, 23,2,		22,2, 20,2, 20,2, 20,2, 0,2, 10,2,	10,2, 10,1, 10,1, 10,1, 10,1, 10,2, 8,2, 10,2,		20,4, 18,2, 18,2, 0,2, 18,2,
	17,4, 15,2, 15,6,		0,4, 15,2, 15,2, 13,2, 11,1, 11,1,		11,6, 10,1, 11,1, 13,10,/*~	13*/ 0,6,
	10,1, 8,1, 10,1, 8,1, 10,1, 11,1, 13,2, 0,2, 11,1, 13,1,		15,2, 0,2, 15,1, 17,1, 18,2, 0,2, 20,1, 18,1,		13,4, 0,1, 6,1, 13,2, 11,2, 11,2,		10,4, 10,1, 11,1, 13,4, 0,2,
	10,1, 8,1, 10,1, 8,1, 10,1, 11,1, 13,2, 0,2, 11,1, 13,1,		15,2, 0,2, 14,1, 15,1, 17,2, 0,3, 10,1,		22,2, 22,2, 0,1, 10,1, 23,2, 22,2, 20,2,		20,4, 18,1, 17,1, 18,2, 0,2, 13,1, 18,1,
	20,4, 18,2, 18,2, 0,2, 13,2,		20,4, 18,2, 18,2, 0,2, 13,1, 18,1,		20,4, 18,2, 18,2, 0,2, 13,1, 18,1,		20,3, 22,1, 20,2, 18,2, 0,2, 18,2,
	17,4, 15,2, 15,2, 0,2, 13,2,		13,4, 11,2, 11,2, 10,2, 8,2,		10,6, 0,6,		10,2, 11,2, 10,2, 11,2, 10,2, 8,2,		6,12,/*~ 6*/
	0xFF
};
unsigned char FreqSelect,MusicSelect;

void main()
{
	Timer0_Init();
	while(1)
	{		
		if(Music[MusicSelect]!=0xFF)
		{
			FreqSelect=Music[MusicSelect];
			MusicSelect++;
			Delay(SPEED/4*Music[MusicSelect]);
			MusicSelect++;
			TR0=0;
			Delay(5);
			TR0=1;
		}else
		{
			TR0=0;
			while(1);
		}
	}
}

void Timer0_Routine() interrupt 1
{
	if(FreqTable[FreqSelect])
	{
		TL0 = FreqTable[FreqSelect]%256;
		TH0 = FreqTable[FreqSelect]/256;
		Buzzer=!Buzzer;
	}
}